# jvm排查

##线程运行诊断

CPU占用过高

- Linux环境下运行某些程序的时候，可能导致CPU的占用过高，这时需要定位占用CPU过高的线程
  - **top**命令，查看是哪个**进程**占用CPU过高
  - **ps H -eo pid, tid（线程id）, %cpu | grep 刚才通过top查到的进程号** 通过ps命令进一步查看是哪个线程占用CPU过高
  - **jstack 进程id** 通过查看进程中的线程的nid，刚才通过ps命令看到的tid来**对比定位**，注意jstack查找出的线程id是**16进制的**，而ps下的tid是十进制，**需要转换** 。看其中信息可以知道定位到具体代码，比如哪行代码导致cpu很高或者哪行导致死锁。

##堆内存、死锁等诊断

* windows下 jdk/bin 下 cmd

* jps

  > jps是查看java进程信息的命令

* jmap -heap pid

  > 查看堆内存情况（只能查某一时刻）

* jconsole

  > 图形界面，可以多功能连续监测 也可以检测死锁

* jvisualvm（j v shou vm）

  > 垃圾回收之后仍然内存很高 
  >
  > 特别功能 它也可以监视 点堆dump 生成快照 收集信息保存起来 生成的快照也可以查找前最大多少个对象以及具体对象的占用情况 